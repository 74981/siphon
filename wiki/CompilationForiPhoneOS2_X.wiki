#summary Compilation guide for iPhone OS 2.X.

= Introduction =

This article describes the steps to generate pjsip on Mac OS X 10.5.5


= Details =

==Get pjsip source code==
Get [http://pjsip.org PjSIP] from subversion repository:

{{{
svn checkout http://svn.pjsip.org/repos/pjproject/trunk pjproject
}}}


==Modify some files==
===Media device for iPhone===

===aconfigure.ac===

In _aconfigure.ac_ file add the lines below displayed with '+'. Of course copy without '+' ;-)

{{{
 if test "$enable_sound" = "no"; then
   true;
 else
  case $target in
+   arm-apple-darwin*)
+        LIBS="$LIBS -framework CoreAudio -framework CoreFoundation -framework AudioToolbox"
+        ac_pjmedia_snd=iphone
+        AC_MSG_RESULT([Checking sound device backend... AudioQueue])
+        ;;
   *darwin*)
 	LIBS="$LIBS -framework CoreAudio -framework CoreServices -framework AudioUnit -framework AudioToolbox"
 	if test "`uname -r`" = "6.8"; then
}}}



===build/rules.mak===
In _rules.mak_ modify, remove lines with '-' and add lines with '+':
{{{
 $(LIB): $(OBJDIRS) $(OBJS) $($(APP)_EXTRA_DEP)
 	if test ! -d $(LIBDIR); then $(subst @@,$(subst /,$(HOST_PSEP),$(LIBDIR)),$(HOST_MKDIR)); fi
-	$(AR) $(LIB) $(OBJS)
-	$(RANLIB) $(LIB)
+	$(RANLIB) -static -o $(LIB) $(OBJS)
}}}
===pjlib/include/pj/compat/os_darwinos.h===
In _os_darwinos.h_ find and comment the following lines :
{{{
/*
 * Socket related
 */
//typedef int socklen_t;
}}}

Without this, you will get an error when you will compile, because socklen_t is redefined. 

===pjmedia/build/os-auto.mak.in===
In _os-auto.mak.in_, add the line with '+'
{{{
 #   - ds:	    	Win32 DirectSound (dsound.c)
+#   - iphone:       iPhone AudioQueue (iphonesound.c)
 #   - null:	    	Null sound device (nullsound.c)
}}}

Add the line below, for example between "Win 32 Direct Sound" and " Null Sound Device"

{{{
#
# iPod/iPhone
#
ifeq ($(AC_PJMEDIA_SND),iphone)
export SOUND_OBJS = iphonesound.o
export CFLAGS += -DPJMEDIA_SOUND_IMPLEMENTATION=PJMEDIA_SOUND_IPHONE_SOUND
endif

}}}

We have defined a new target for sound device.

==Configuration==

==Compilation==